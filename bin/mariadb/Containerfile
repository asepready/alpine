# Use a Alpine base image
FROM docker.io/library/alpine:3.16

LABEL Maintainer="Asep Ready <asepready@gmail.com>" \
  Description="MariaDB container based on Alpine Linux"

# Timezone
RUN echo "Asia/Jakarta" > /etc/timezone

# Install PHP
RUN apk add --update mariadb \
  mariadb-client mariadb-server-utils && \
  rm -rf /var/cache/apk/*

# Set up MariaDB directories and permissions
RUN mkdir -p /run/mysqld && chown -R mysql:mysql /var/lib/mysql /run/mysqld

# Set environment variables for MariaDB (optional)
ENV MYSQL_ROOT_PASSWORD=root \
    MYSQL_DATABASE=mydb \
    MYSQL_USER=myuser \
    MYSQL_PASSWORD=mypassword

# Copy Configure 
COPY my.cnf.d/mariadb-server.cnf /etc/my.cnf.d/mariadb-server.cnf

# Expose the default MariaDB port
EXPOSE 3306

# Command to run the MariaDB server
CMD ["mysqld", "--datadir=/var/lib/mysql", "--user=mysql"]